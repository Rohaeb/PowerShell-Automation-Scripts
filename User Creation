$users = Import-Csv "C:\Scripts\newusers.csv" 
$logFile = "C:\Scripts\UserCreationLog.csv"
foreach ($user in $users) {
try{
$securePassword = ConvertTo-SecureString $user.Password -AsPlainText -Force
$params = @{
Name = $user.Name 
SamAccountName = $user.Username 
UserPrincipalName = "$($user.Username)@test.local" 
AccountPassword = $securePassword  
Path = $user.OU 
Enabled = $true  
PasswordNeverExpires = $true 
ChangePasswordAtLogon = $false
}
New-ADUser @params

#log success 

"$((Get-Date).ToString('u')),$($user.Name),$($user.Username),$($user.OU),Success" | Out-File -Append $logFile
} catch {
#log error

"$((Get-Date).ToString('u')),$($user.Name),$($user.Username),$($user.OU),Error: $($_.Exception.Message)" | Out-File -Append $logFile
}
}
